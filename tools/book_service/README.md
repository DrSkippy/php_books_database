## Test Book Service

### Unit Tests

```
poetry run pytest --cov-report term-missing --cov=books test_books/test_api_util.py 
```
### Test Script

```
poetry run python test_books/test_docker_api.py 
```

### Basic API Endpoints in local test Docker container:


```
http://localhost/configuration
http://localhost/valid_locations
http://localhost/recent
http://localhost/add_books
http://localhost/add_read_dates
http://localhost/books_by_isbn
http://localhost/update_edit_read_note
http://localhost/update_book_note_status
http://localhost/summary_books_read_by_year
http://localhost/summary_books_read_by_year/<target_year>
http://localhost/books_read
http://localhost/books_read/<target_year>
http://localhost/status_read/<book_id>
http://localhost/books_search
http://localhost/add_tag/<book_id>/<tag>
http://localhost/tag_counts
http://localhost/tag_counts/<tag>
http://localhost/tags/<book_id>
http://localhost/update_tag_value/<current>/<updated>
http://localhost/tags_search/<match_str>
http://localhost/tag_maintenance
http://localhost/date_page_records/<record_id>
http://localhost/record_set/<book_id>
http://localhost/add_date_page
http://localhost/add_book_estimate/<book_id>/<last_readable_page>
http://localhost/add_book_estimate/<book_id>/<last_readable_page>/<start_date>
http://localhost/image/year_progress_comparison.png
http://localhost/image/year_progress_comparison.png/<window>
http://localhost/image/all_years.png
http://localhost/image/all_years.png/<year>

```

### Curl Examples

List of Authors of unrecycled books in alphabetical order:
```angular2html
curl -H "x-api-key: sdf876a234hqkajsdv9876x87ehruia76df" \
http://172.17.0.2:8083/books_search?Recycled=0 | jq .data[][1]
```

Add books:
```angular2html
curl -X POST -H "Content-type: application/json" \
-H "x-api-key: sdf876a234hqkajsdv9876x87ehruia76df" \
-d @./examples/test_add_book.json \
http://172.17.0.2:8083/add_books
```

Update a book:
```angular2html
curl -X POST -H "Content-type: application/json" \
-H "x-api-key: sdf876a234hqkajsdv9876x87ehruia76df" \
-d @./examples/test_update_book.json \
http://172.17.0.2:8083/update_book
```

Additional Curl Examples:

Generated by bin/generate_curl_examples.py

```angular2html
curl -X GET -H 'x-api-key: sdf876a234hqkajsdv9876x87ehruia76df' http://localhost/configuration | jq .
curl -X GET -H 'x-api-key: sdf876a234hqkajsdv9876x87ehruia76df' http://localhost/valid_locations | jq .
curl -X GET -H 'x-api-key: sdf876a234hqkajsdv9876x87ehruia76df' http://localhost/recent | jq .
curl -X GET -H 'x-api-key: sdf876a234hqkajsdv9876x87ehruia76df' http://localhost/books_read/2020 | jq .
curl -X GET -H 'x-api-key: sdf876a234hqkajsdv9876x87ehruia76df' http://localhost/status_read/1576 | jq .
curl -X GET -H 'x-api-key: sdf876a234hqkajsdv9876x87ehruia76df' http://localhost/tag_counts/science | jq .
curl -X GET -H 'x-api-key: sdf876a234hqkajsdv9876x87ehruia76df' http://localhost/tags/1576 | jq .
curl -X GET -H 'x-api-key: sdf876a234hqkajsdv9876x87ehruia76df' http://localhost/date_page_records/1 | jq .
curl -X GET -H 'x-api-key: sdf876a234hqkajsdv9876x87ehruia76df' http://localhost/books_search?Author=Lewis | jq .
curl -X GET -H 'x-api-key: sdf876a234hqkajsdv9876x87ehruia76df' http://localhost/tags_search/science | jq .
```

FAILED TO OPEN COLLECTION ERROR

```angular2html
The currently activated Python version 3.9.10 is not supported by the project (3.8.12).
Trying to find and use a compatible version. 
Using python3 (3.8.12)
Updating dependencies
Resolving dependencies... (0.4s)

Failed to unlock the collection!
scott@scott-pi-desktop:~/Working/php_books_database/tools/book_service$ export PYTHON_KEYRING_BACKEND=keyring.backends.fail.Keyring
```