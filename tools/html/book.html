<!DOCTYPE html>
<html>
<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" href="table-style.css">
</head>
<body>
<h1>Result</h1>
<table id='mytable' class="styled-table">
    <thead>
    <tr>
        <th>BookCollectionID</th>
        <th>Title</th>
        <th>Author</th>
        <th>CopyrightDate</th>
        <th>Pages</th>
        <th>ReadDate</th>
    </tr>
    </thead>
    <tbody>
    <div>
    </div>
    </tbody>
</table>
<h1>Record Detail</h1>
<table id='sumtable' class="styled-table">
    <thead>
    <tr>
        <th>BookCollectionID</th>
        <th>Title</th>
        <th>Author</th>
        <th>CopyrightDate</th>
        <th>Publisher</th>
        <th>Type</th>
        <th>Pages</th>
        <th>Recyl'd</th>
        <th>Location</th>
        <th>ISBN</th>
        <th>ISBN13</th>
        <th>ReadDate</th>
        <th>Note</th>
    </tr>
    </thead>
    <tbody>
    <div>
    </div>
    </tbody>
</table>
<script>
    var bookCollectionID = 102;

    function setval(bcid) {
        $.ajaxSetup({async: false});  // suppress async so the summary row is always at the bottom
        bookCollectionID = bcid;
        var urlId = "http://192.168.127.8/books/books_search?BookCollectionID=" + bookCollectionID;
        var urlTag = "http://192.168.127.8/books/tags/" + bookCollectionID;

        $.getJSON(urlId, function (data) {
            var obj = data['data'];
            for (var i = 0; i < obj.length; i++) {
                var trOne = "<tr id='replace-me-one'>" +
                    "<td>" + obj[i][0] + "</td>" +
                    "<td>" + obj[i][1] + "</td>" +
                    "<td>" + obj[i][2] + "</td>" +
                    "<td>" + obj[i][3] + "</td>" +
                    "<td>" + obj[i][5] + "</td>" +
                    "<td>" + obj[i][6] + "</td>" +
                    "<td>" + obj[i][7] + "</td>" +
                    "<td>" + obj[i][10] + "</td>" +
                    "<td>" + obj[i][11] + "</td>" +
                    "<td>" + obj[i][4] + "</td>" +
                    "<td>" + obj[i][12] + "</td>" +
                    "<td>" + obj[i][13] + "</td>" +
                    "<td>" + obj[i][9] + "</td></tr>";
                $("#replace-me-one").replaceWith(trOne);
            }
        });

        $.getJSON(urlTag, function (data) {
            var obj = data['tag_list'];
            console.log(obj);
            var trTwo = "<tr id='replace-me-two'>" +
                "<td>Tags:</td><td colspan=13>" + obj.join(", ") + "</td></tr>";
            $("#replace-me-two").replaceWith(trTwo);
        });
    }

    $(document).ready(function () {
        const queryString = window.location.search;
        const urlParams = new URLSearchParams(queryString);
        var url = "http://192.168.127.8/books/books_search?";
        if (urlParams.has("author")) {
            url = url + "author=" + urlParams.get("author");
        } else if (urlParams.has("title")) {
            url = url + "title=" + urlParams.get("title");
        }
        $.getJSON(url, function (data) {
            var obj = data['data'];
            for (var i = 0; i < obj.length; i++) {
                var tr = "<tr>" +
                    "<td><button onclick=\"setval(" + obj[i][0] + ")\">" + obj[i][0].toString() + "</button></td>" +
                    "<td>" + obj[i][1] + "</td>" +
                    "<td>" + obj[i][2] + "</td>" +
                    "<td>" + obj[i][3] + "</td>" +
                    "<td>" + obj[i][7] + "</td>" +
                    "<td>" + obj[i][13] + "</td></tr>";
                $("#mytable").append(tr);
            }

        });
        var trOne = "<tr id='replace-me-one'>" +
            "<td/><td>(select a record)</td><td/><td/><td/><td/><td/><td/><td/><td/><td/><td/><td/>" +
            "</tr>";
        $("#sumtable").append(trOne);
        var trTwo = "<tr id='replace-me-two'>" +
            "<td>Tags:</td><td colspan=13></td></tr>";
        $("#sumtable").append(trTwo);

    })

</script>
</body>
</html>

